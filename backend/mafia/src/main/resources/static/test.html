<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>방 목록 테스트</title>
    <style>
        .room-card {
            margin: 10px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .button-group {
            margin-top: 10px;
        }
        .button-group button {
            margin-right: 5px;
            padding: 5px 10px;
        }
        .player-list {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
<h2>방 목록</h2>
<button onclick="loadRooms()">새로고침</button>
<div id="roomList"></div>

<script>
    function loadRooms() {
        fetch('http://localhost:8080/api/rooms')
            .then(response => response.json())
            .then(data => {
                console.log('전체 응답 데이터:', data);
                displayRooms(data.result);
            })
            .catch(error => console.error('Error:', error));
    }

    function enterRoom(roomId) {
        fetch(`http://localhost:8080/api/rooms/${roomId}/enter`, {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            console.log('입장 성공:', data);
            loadRooms(); // 방 목록 새로고침
        })
        .catch(error => console.error('입장 실패:', error));
    }

    function leaveRoom(roomId) {
        fetch(`http://localhost:8080/api/rooms/${roomId}/leave`, {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            console.log('퇴장 성공:', data);
            loadRooms(); // 방 목록 새로고침
        })
        .catch(error => console.error('퇴장 실패:', error));
    }

    function deleteRoom(roomId) {
        fetch(`http://localhost:8080/api/rooms/${roomId}`, {
            method: 'DELETE',
        })
        .then(response => response.json())
        .then(data => {
            console.log('방 삭제 성공:', data);
            loadRooms(); // 방 목록 새로고침
        })
        .catch(error => console.error('방 삭제 실패:', error));
    }

    function displayRooms(rooms) {
        const roomList = document.getElementById('roomList');
        roomList.innerHTML = '';

        rooms.forEach(room => {
            const roomElement = document.createElement('div');
            roomElement.className = 'room-card';

            // 기본 방 정보
            roomElement.innerHTML = `
                <div>
                    <h3>방 제목: ${room.roomTitle}</h3>
                    <p>방 ID: ${room.roomId}</p>
                    <p>현재 인원: ${room.curPlayers}/15</p>
                    <p>방장: ID ${room.memberId}</p>
                </div>

                <!-- 참가자 목록 표시 -->
                <div class="player-list">
                    <h4>참가자 목록:</h4>
                    <div id="players-${room.roomId}">
                        로딩중...
                    </div>
                </div>

                <!-- 버튼 그룹 -->
                <div class="button-group">
                    <button onclick="enterRoom(${room.roomId})">입장</button>
                    <button onclick="leaveRoom(${room.roomId})">퇴장</button>
                    <button onclick="deleteRoom(${room.roomId})">방 삭제</button>
                </div>
            `;

            roomList.appendChild(roomElement);

            // 해당 방의 참가자 목록 로드
            loadRoomPlayers(room.roomId);
        });
    }

    function loadRoomPlayers(roomId) {
        // RoomPlayer 정보를 가져오는 API 호출
        fetch(`http://localhost:8080/api/rooms/${roomId}/players`)
            .then(response => response.json())
            .then(data => {
                const playersList = document.getElementById(`players-${roomId}`);
                if (data.result && data.result.length > 0) {
                    const playerItems = data.result.map(player =>
                        `<div>플레이어 ID: ${player.memberId}
                         (${player.isReady ? '준비완료' : '대기중'})</div>`
                    ).join('');
                    playersList.innerHTML = playerItems;
                } else {
                    playersList.innerHTML = '참가자가 없습니다.';
                }
            })
            .catch(error => {
                console.error('참가자 목록 로드 실패:', error);
                const playersList = document.getElementById(`players-${roomId}`);
                playersList.innerHTML = '참가자 목록을 불러올 수 없습니다.';
            });
    }

    // 페이지 로드시 방 목록 로딩
    loadRooms();
</script>
</body>
</html>